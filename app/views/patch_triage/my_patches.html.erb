<% content_for :title do %>
  Your Patches
<% end %>

<div class="committer-container">
  <div class="committer-header">
    <h1>Your Patches</h1>
    <% if @current_user_github_username.present? %>
      <p class="my-patches-subtitle">
        GitHub: <%= @current_user_github_username %>
      </p>
    <% end %>
  </div>

  <div class="patch-tabs">
    <a href="/patch-triage/my-patches?tab=authored" class="tab-btn <%= 'active' if @tab == 'authored' %>">Authored</a>
    <a href="/patch-triage/my-patches?tab=claimed" class="tab-btn <%= 'active' if @tab == 'claimed' %>">Claimed</a>
    <a href="/patch-triage/my-patches?tab=resolved" class="tab-btn <%= 'active' if @tab == 'resolved' %>">Resolved</a>
  </div>

  <div class="committer-stats-grid">
    <div class="stat-item">
      <span class="stat-value"><%= @tab_stats[:total_patches] %></span>
      <span class="stat-label">Patches</span>
    </div>
    <div class="stat-item">
      <span class="stat-value"><%= @tab_stats[:total_votes] %></span>
      <span class="stat-label">Total Votes</span>
    </div>
    <div class="stat-item">
      <span class="stat-value useful"><%= @tab_stats[:avg_useful_ratio] %>%</span>
      <span class="stat-label">Avg Approval</span>
    </div>
  </div>

  <% if @patches.any? %>
    <div class="patch-list">
      <% @patches.each_with_index do |patch, index| %>
        <a href="/patch-triage/<%= patch.id %>" class="patch-list-item">
          <span class="patch-rank"><%= index + 1 %></span>
          <span class="patch-info">
            <span class="patch-name"><%= patch.title.sub(/^Audit Fix:\s*/i, '').truncate(70) %></span>
            <span class="patch-meta-line">
              <code><%= patch.commit_hash[0..7] %></code>
              <% if patch.issue_type.present? %>
                <span class="badge badge-<%= patch.issue_type %>"><%= patch.issue_type %></span>
              <% end %>
              <% if patch.resolved? %>
                <span class="badge badge-resolution badge-<%= patch.resolution_status %>"><%= patch.resolution_status %></span>
              <% end %>
              <% if patch.audit_date.present? %>
                <span class="patch-date"><%= patch.audit_date.strftime("%Y-%m-%d") %></span>
              <% end %>
            </span>
          </span>
          <% if patch.useful_count + patch.not_useful_count > 0 %>
            <span class="patch-score useful"><%= patch.useful_ratio %>%</span>
          <% else %>
            <span class="patch-score unrated">-</span>
          <% end %>
        </a>
      <% end %>
    </div>
  <% else %>
    <p class="empty-message">
      <% case @tab %>
      <% when "authored" %>
        <% if @current_user_github_id %>
          No patches found linked to your GitHub account.
        <% else %>
          Link your GitHub account to see patches you've authored.
        <% end %>
      <% when "claimed" %>
        You haven't claimed any patches yet.
      <% when "resolved" %>
        You haven't resolved any patches yet.
      <% end %>
    </p>
  <% end %>

  <div class="committer-actions">
    <a href="/patch-triage/leaderboard" class="btn-secondary">Back to Leaderboard</a>
    <% if @user_stats[:remaining] > 0 %>
      <a href="/patch-triage" class="btn-primary">Rate Patches</a>
    <% end %>
  </div>
</div>
